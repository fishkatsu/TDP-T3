<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="" />
    <title>Chatbot Interface</title>
    <link
            href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
            rel="stylesheet"
    />
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.1/dist/cdn.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.8.1/flowbite.min.js"></script>
</head>
<body class="bg-gray-100 font-sans">
<div class="container mx-auto p-4">
    <h1 class="text-3xl font-bold mb-10">Swinburne Online's Frequently Asked Question</h1>
    {% if conversation_history %}
    <div id="accordion-collapse" data-accordion="collapse">
        <h2 id="accordion-collapse-heading-1">
            <button type="button" class="flex items-center justify-between w-full p-2 font-medium text-left text-gray-500 border border-b-0 border-gray-200 rounded-t-xl focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-800 dark:border-gray-700 dark:text-gray-400 hover:bg-gray-100 dark:hover-bg-gray-800" data-accordion-target="#accordion-collapse-body-1" aria-expanded="true" aria-controls="accordion-collapse-body-1">
                <h2 class="text-2xl font-semibold mt-8">Conversation History:</h2>
                <svg data-accordion-icon class="w-3 h-3 rotate-180 shrink-0" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5 5 1 1 5"/>
                </svg>
            </button>
        </h2>
        <div id="accordion-collapse-body-1" class="hidden" aria-labelledby="accordion-collapse-heading-1">
            <div class="p-5 border border-b-0 border-gray-200 dark:border-gray-700 dark:bg-gray-900">
                {% for interaction in conversation_history %}
                <div class="mb-2 p-2 rounded-lg shadow-md bg-white">
                    <p><b>User:</b> {{ interaction['User Query'] }}</p>
                    <p><b>Response:</b> {{ interaction['Response'] }}</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}
    <!-- <div class="grid grid-row-10 gap-4 mt-8">
        <h2 class="text-2xl font-semibold">Conversation History:</h2>
            <div class="history-container">
                {% for interaction in conversation_history %}
                    <div class="mb-2 p-2 rounded-lg shadow-md bg-white">
                        <p><b>User:</b> {{ interaction['User Query'] }}</p>
                        <p><b>Response:</b> {{ interaction['Response'] }}</p>
                    </div>
                {% endfor %}
            </div>
    </div> -->

    <div class="grid grid-row-10 gap-4">
        <h2 class="text-2xl font-semibold mt-8">Chatbot Response:</h2>
        <div class="response-container">
            <p class="bg-white row-span-6 p-4 rounded-lg shadow-md mt-1 w-2/3">
                {{ answer }}
            </p>
            <!-- Check if there are suggestions to display -->
            {% if suggestions %}
            <div class="grid grid-cols-3 gap-4 suggestions mt-4">
                <h2 class="text-2xl font-semibold">Suggestions:</h2>
                <form action="/ask" method="post">
                    <ul>
                        {% for suggestion in suggestions %}
                        <li class="bg-white row-span-6 p-4 rounded-lg shadow-md mt-1 w-3/3 suggestion text-sm">
                            <button type="submit" name="selected_suggestion" value="{{ suggestion }}">{{ suggestion }}</button>
                        </li>
                        {% endfor %}
                    </ul>
                    <input type="hidden" name="user_question" value="{{ user_question }}">
                </form>
            </div>
            {% elif topics %}
            <!-- Display topics when there are no suggestions -->
            <div id="accordion-collapse2" data-accordion="collapse">
                <h4 id="accordion-collapse-heading-2">
                    <button type="button" class="flex items-center justify-between w-full p-1 font-medium text-left text-gray-500 border border-b-0 border-gray-200 rounded-t-xl focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-800 dark:border-gray-700 dark:text-gray-400 hover:bg-gray-100 dark:hover-bg-gray-800" data-accordion-target="#accordion-collapse-body-2" aria-expanded="false" aria-controls="accordion-collapse-body-2">
                        <h4 class="text-sm font-semibold mt-8">You can ask about following topics:</h4>
                        <svg data-accordion-icon class="w-3 h-3 rotate-180 shrink-0" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 10 6">
                            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5 5 1 1 5"/>
                        </svg>
                    </button>
                </h4>
                <div id="accordion-collapse-body-2" class="hidden" aria-labelledby="accordion-collapse-heading-2">
                    <div class="p-5 border border-b-0 border-gray-200 dark:border-gray-700 dark:bg-gray-900">
                        {% for topic in topics %}
                        <li class="bg-white row-span-6 p-4 rounded-lg shadow-md mt-1 w-3/3 suggestion text-sm">
                            {{ topic }}
                        </li>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    <br/>
    <form action="/ask" method="post" class="grid grid-cols-8 gap-4">
        <label for="user_question" class="text-xl text-right">Ask a question:</label>
        <input
                type="text"
                id="user_question"
                name="user_question"
                required
                class="col-span-3 px-4 py-2 rounded-lg border focus:outline-none focus:border-blue-400"
        />
        <button
                class="col-span-1 px-4 py-2 rounded-full bg-blue-500 text-white hover:bg-blue-600 focus:outline-none"
                type="submit"
        >
            Submit
        </button>
    </form>
</div>
<script>
    // Ensure Alpine.js has been fully loaded
    document.addEventListener('alpine:initializing', () => {
        Alpine.store('isHistoryOpen', false);
    });
</script>
</body>
</html>